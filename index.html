<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Skill Performance Analyzer</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0b1020;
      color: #e5e7eb;
      padding: 20px;
    }
    h1 { color: #60a5fa; }
    input, select { margin: 15px 0; padding: 6px; }
    table {
      border-collapse: collapse;
      margin-top: 20px;
      width: 100%;
    }
    th, td {
      border: 1px solid #374151;
      padding: 10px;
      text-align: center;
    }
    th { background: #111827; }
    canvas { margin-top: 30px; }
  </style>
</head>
<body>

  <h1>Skill Performance Analyzer</h1>
  <p>Upload CSV with columns: <b>Assignment, Scored, Full Marks, Skill</b></p>

  <input type="file" id="csvFile" accept=".csv" />
  <br />
  <label>Select Skill: </label>
  <select id="skillSelect">
    <option value="">-- Select Skill --</option>
  </select>

  <table id="resultTable">
    <thead>
      <tr>
        <th>Skill</th>
        <th>Total Scored</th>
        <th>Total Full Marks</th>
        <th>Performance (%)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <canvas id="skillChart" width="400" height="200"></canvas>

  <script>
    const fileInput = document.getElementById('csvFile');
    const tableBody = document.querySelector('#resultTable tbody');
    const skillSelect = document.getElementById('skillSelect');
    let chart;
    let skillData = {};

    fileInput.addEventListener('change', handleFile);
    skillSelect.addEventListener('change', handleSkillChange);

    function handleFile(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = e => processCSV(e.target.result);
      reader.readAsText(file);
    }

    function processCSV(text) {
      const rows = text.trim().split('\n').map(r => r.split(','));
      const headers = rows.shift();

      const skillIndex = headers.indexOf('Skill');
      const scoredIndex = headers.indexOf('Scored');
      const fullIndex = headers.indexOf('Full Marks');

      skillData = {};

      rows.forEach(row => {
        const skill = row[skillIndex];
        const scored = Number(row[scoredIndex]);
        const full = Number(row[fullIndex]);

        if (!skillData[skill]) {
          skillData[skill] = { scored: 0, full: 0 };
        }
        skillData[skill].scored += scored;
        skillData[skill].full += full;
      });

      populateSkillDropdown();
      clearDisplay();
    }

    function populateSkillDropdown() {
      skillSelect.innerHTML = '<option value="">-- Select Skill --</option>';
      Object.keys(skillData).forEach(skill => {
        const option = document.createElement('option');
        option.value = skill;
        option.textContent = skill;
        skillSelect.appendChild(option);
      });
    }

    function handleSkillChange() {
      const selectedSkill = skillSelect.value;
      if (!selectedSkill) {
        clearDisplay();
        return;
      }
      const data = skillData[selectedSkill];
      renderTable(selectedSkill, data);
      renderChart(selectedSkill, data);
    }

    function clearDisplay() {
      tableBody.innerHTML = '';
      if (chart) chart.destroy();
    }

    function renderTable(skill, data) {
      tableBody.innerHTML = '';
      const percent = ((data.scored / data.full) * 100).toFixed(2);
      const row = `<tr>
        <td>${skill}</td>
        <td>${data.scored}</td>
        <td>${data.full}</td>
        <td>${percent}%</td>
      </tr>`;
      tableBody.insertAdjacentHTML('beforeend', row);
    }

    function renderChart(skill, data) {
      if (chart) chart.destroy();

      chart = new Chart(document.getElementById('skillChart'), {
        type: 'bar',
        data: {
          labels: ['Scored', 'Full Marks'],
          datasets: [{
            label: skill,
            data: [data.scored, data.full]
          }]
        },
        options: {
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }
  </script>

</body>
</html>
